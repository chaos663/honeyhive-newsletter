<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% if page.title %}{{ page.title | escape }} | {{ site.title }}{% else %}{{ site.title }}{% endif %}</title>
  <meta name="description" content="{{ page.excerpt | default: site.description | strip_html | truncatewords: 50 }}">
  <meta property="og:title" content="{% if page.title %}{{ page.title | escape }}{% else %}{{ site.title }}{% endif %}">
  <meta property="og:description" content="{{ page.excerpt | default: site.description | strip_html | truncatewords: 50 }}">
  <meta property="og:url" content="{{ page.url | absolute_url }}">
  <meta property="og:type" content="{% if page.layout == 'post' %}article{% else %}website{% endif %}">
  <meta property="og:site_name" content="{{ site.title }}">
  
  <!-- Preconnect for performance -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  
  <!-- Font Preload for critical rendering -->
  <link rel="preload" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" as="style">
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" as="style">
  
  <!-- Pretendard Font -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css">
  
  <!-- JetBrains Mono for code -->
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  
  <!-- Pagefind Search -->
  <link href="{{ '/pagefind/pagefind-ui.css' | relative_url }}" rel="stylesheet">
  
  <!-- Main Stylesheet -->
  <link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}">
  
  {% feed_meta %}
  {% seo %}
  
  <!-- Native lazy loading support script -->
  <script>
    // Add lazy loading to all images in post content
    document.addEventListener('DOMContentLoaded', function() {
      document.querySelectorAll('.post-content img').forEach(function(img) {
        if (!img.hasAttribute('loading')) {
          img.setAttribute('loading', 'lazy');
          img.setAttribute('decoding', 'async');
        }
      });
    });
  </script>
</head>
<body>
  <nav class="site-nav">
    <div class="nav-inner">
      <a href="{{ '/' | relative_url }}" class="site-logo">
        <span class="logo-icon">üêù</span>
        <span class="logo-text">{{ site.title }}</span>
      </a>
      <div class="nav-links">
        <a href="{{ '/' | relative_url }}">Home</a>
        <a href="{{ '/feed.xml' | relative_url }}">RSS</a>
        <button id="search-btn" class="search-btn" aria-label="Í≤ÄÏÉâ (‚åòK)">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="M21 21l-4.35-4.35"></path>
          </svg>
          <span class="search-shortcut">‚åòK</span>
        </button>
      </div>
    </div>
  </nav>

  <!-- Search Modal -->
  <div id="search-modal" class="search-modal" aria-hidden="true">
    <div class="search-modal-backdrop"></div>
    <div class="search-modal-container">
      <div class="search-modal-header">
        <span class="search-modal-title">üîç Îâ¥Ïä§Î†àÌÑ∞ Í≤ÄÏÉâ</span>
        <button class="search-modal-close" aria-label="Îã´Í∏∞">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6L6 18M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      <div id="search-container"></div>
    </div>
  </div>

  <main class="site-main">
    {{ content }}
  </main>

  <footer class="site-footer">
    <div class="footer-inner">
      <p>&copy; {{ 'now' | date: "%Y" }} {{ site.title }}. Curated with üçØ</p>
      <div class="visitor-counter">
        <img src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fnews.honeybarrel.co.kr&count_bg=%232D2926&title_bg=%23FDB813&icon=&icon_color=%232D2926&title=visitors&edge_flat=true" alt="Î∞©Î¨∏Ïûê Ïàò">
      </div>
    </div>
  </footer>

  <!-- Pagefind Scripts -->
  <script src="{{ '/pagefind/pagefind-ui.js' | relative_url }}" defer></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const searchBtn = document.getElementById('search-btn');
      const searchModal = document.getElementById('search-modal');
      const searchClose = searchModal.querySelector('.search-modal-close');
      const searchBackdrop = searchModal.querySelector('.search-modal-backdrop');
      let pagefindUI = null;

      function openSearch() {
        searchModal.classList.add('active');
        searchModal.setAttribute('aria-hidden', 'false');
        document.body.style.overflow = 'hidden';
        
        // Initialize Pagefind UI on first open
        if (!pagefindUI && typeof PagefindUI !== 'undefined') {
          pagefindUI = new PagefindUI({
            element: '#search-container',
            showSubResults: true,
            showImages: false,
            translations: {
              placeholder: 'Í≤ÄÏÉâÏñ¥Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî...',
              zero_results: 'Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§',
              many_results: '[count]Í∞úÏùò Í≤∞Í≥º',
              one_result: '1Í∞úÏùò Í≤∞Í≥º',
              searching: 'Í≤ÄÏÉâ Ï§ë...'
            }
          });
        }
        
        // Focus search input
        setTimeout(() => {
          const input = searchModal.querySelector('.pagefind-ui__search-input');
          if (input) input.focus();
        }, 100);
      }

      function closeSearch() {
        searchModal.classList.remove('active');
        searchModal.setAttribute('aria-hidden', 'true');
        document.body.style.overflow = '';
      }

      // Event listeners
      searchBtn.addEventListener('click', openSearch);
      searchClose.addEventListener('click', closeSearch);
      searchBackdrop.addEventListener('click', closeSearch);

      // Keyboard shortcuts
      document.addEventListener('keydown', function(e) {
        // ‚åòK or Ctrl+K to open
        if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
          e.preventDefault();
          if (searchModal.classList.contains('active')) {
            closeSearch();
          } else {
            openSearch();
          }
        }
        // Escape to close
        if (e.key === 'Escape' && searchModal.classList.contains('active')) {
          closeSearch();
        }
      });
    });
  </script>
</body>
</html>
